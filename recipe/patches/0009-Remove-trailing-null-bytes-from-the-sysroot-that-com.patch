From 71a2ecfbaf58f89e3ea009fc4c8709c47c71f2e1 Mon Sep 17 00:00:00 2001
From: Chris Burr <christopher.burr@cern.ch>
Date: Thu, 3 Mar 2022 23:19:02 +0100
Subject: [PATCH 9/9] Remove trailing null bytes from the sysroot that come
 from conda's relocation

---
 clang/lib/Driver/Driver.cpp | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/clang/lib/Driver/Driver.cpp b/clang/lib/Driver/Driver.cpp
index ec97f298cfc6..6cd0bcd26f24 100644
--- a/clang/lib/Driver/Driver.cpp
+++ b/clang/lib/Driver/Driver.cpp
@@ -147,6 +147,9 @@ Driver::Driver(StringRef ClangExecutable, StringRef TargetTriple,
   if (!this->VFS)
     this->VFS = llvm::vfs::getRealFileSystem();
 
+  // Remove trailing null bytes from the sysroot that come from conda's relocation
+  SysRoot = std::string(SysRoot.c_str());
+
   Name = std::string(llvm::sys::path::filename(ClangExecutable));
   Dir = std::string(llvm::sys::path::parent_path(ClangExecutable));
   InstalledDir = Dir; // Provide a sensible default installed dir.
